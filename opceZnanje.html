<?php
require "includes/connection.php";

// Provjera sesije
if (!isset($_SESSION['username'])) {
    header("Location: index.php");
    exit();
}
?>
<!DOCTYPE html>
<html lang="bs">
<head>
    <meta charset="UTF-8">
    <title>Opƒáe Znanje | Kvizomanija</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #f6d365, #fda085); margin: 0; padding: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .quiz-container { max-width: 600px; width: 90%; background: #fff; padding: 40px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.25); text-align: center; position: relative; overflow: hidden; }
        
        /* Stilovi za Start Ekran */
        .icon-circle { width: 80px; height: 80px; background: #fff3cd; color: #d97706; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 20px; }
        .rules-list { list-style: none; padding: 0; margin: 25px 0; text-align: left; background: #fffaf0; padding: 20px; border-radius: 12px; }
        .rules-list li { margin-bottom: 12px; font-size: 15px; display: flex; align-items: center; color: #78350f; }
        .rules-list li::before { content: '‚úîÔ∏è'; margin-right: 10px; color: #f59e0b; }
        
        .btn { background: #f59e0b; color: #fff; border: none; padding: 15px 40px; font-size: 18px; font-weight: 600; border-radius: 30px; cursor: pointer; margin-top: 10px; transition: 0.3s; width: 100%; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); }
        .btn:hover { background: #d97706; transform: translateY(-3px); box-shadow: 0 6px 20px rgba(245, 158, 11, 0.6); }
        
        .timer { font-size: 18px; font-weight: 700; color: #d97706; margin-bottom: 20px; background: #fff3cd; display: inline-block; padding: 8px 20px; border-radius: 20px; }
        
        .answers button { width: 100%; padding: 16px; margin: 8px 0; border: 2px solid #fff7ed; border-radius: 12px; background: #fff; font-size: 16px; cursor: pointer; transition: 0.2s; font-weight: 500; color: #431407; text-align: left; padding-left: 20px; }
        .answers button:hover:not([disabled]) { border-color: #f59e0b; background: #fffaf0; color: #d97706; }
        
        .correct { background: #48bb78 !important; color: #fff !important; border-color: #48bb78 !important; }
        .wrong { background: #f56565 !important; color: #fff !important; border-color: #f56565 !important; }
        
        .warning-box { background: #fff5f5; color: #c53030; padding: 12px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f56565; font-size: 0.85rem; text-align: left; }
        h2 { color: #1a202c; margin-bottom: 10px; font-size: 1.8rem; }
        p.desc { color: #718096; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="quiz-container" id="quizBox">
    <div class="intro" id="startScreen">
        <div class="icon-circle">üß†</div>
        <h2>Opƒáe Znanje</h2>
        <p class="desc">Poka≈æi koliko poznaje≈° svijet oko sebe!</p>
        
        <ul class="rules-list">
            <li><strong>15 pitanja</strong> iz geografije, historije i kulture.</li>
            <li><strong>15 sekundi</strong> vremena po pitanju.</li>
            <li>Brzina je bitna! Tvoje vrijeme ide na rang listu.</li>
        </ul>

        <div class="warning-box">
            ‚ö†Ô∏è <strong>Anti-Cheat Sistem:</strong><br>
            Nemoj osvje≈æavati stranicu! To se raƒçuna kao netaƒçan odgovor.
        </div>

        <button class="btn" onclick="startQuiz()">Pokreni Kviz üöÄ</button>
    </div>

    <div id="quizScreen" style="display:none;">
        <div class="timer">‚è± <span id="time">15</span>s</div>
        <h3 id="question" style="min-height: 60px; display: flex; align-items: center; justify-content: center;"></h3>
        <div class="answers" id="answerBtns">
            <button onclick="checkAnswer(0)"></button>
            <button onclick="checkAnswer(1)"></button>
            <button onclick="checkAnswer(2)"></button>
        </div>
        <div style="margin-top: 20px; color: #a0aec0; font-size: 0.9rem;">
            Pitanje <span id="qIndex">1</span> / <span id="qTotal">15</span>
        </div>
    </div>
</div>

<script>
// --- TVOJA PITANJA ---
const questions = [
    { q: "Glavni grad BiH je?", a: ["Mostar", "Sarajevo", "Tuzla"], c: 1 },
    { q: "Koliko kontinenata postoji (po najƒçe≈°ƒáem modelu)?", a: ["5", "6", "7"], c: 2 },
    { q: "Najveƒáa planeta u Sunƒçevom sistemu je?", a: ["Mars", "Jupiter", "Zemlja"], c: 1 },
    { q: "Ko je napisao 'Na Drini ƒáuprija'?", a: ["Ivo Andriƒá", "Mak Dizdar", "Me≈°a Selimoviƒá"], c: 0 },
    { q: "Hemijski simbol za vodu je?", a: ["H2O", "CO2", "O2"], c: 0 },
    { q: "Koja se smatra najdu≈æom rijekom na svijetu?", a: ["Nil", "Amazon", "Dunav"], c: 0 },
    { q: "Koji je najveƒái okean na Zemlji?", a: ["Atlantski", "Indijski", "Pacifiƒçki"], c: 2 },
    { q: "Koliko minuta ima jedan sat?", a: ["100", "60", "30"], c: 1 },
    { q: "Koja planeta je najbli≈æa Suncu?", a: ["Venera", "Merkur", "Mars"], c: 1 },
    { q: "Glavni grad Francuske je?", a: ["Pariz", "Rim", "Madrid"], c: 0 },
    { q: "Koja je povr≈°inski najveƒáa dr≈æava svijeta?", a: ["SAD", "Rusija", "Kina"], c: 1 },
    { q: "Koliko slova ima engleska abeceda?", a: ["24", "25", "26"], c: 2 },
    { q: "Koja ≈æivotinja je simbol Australije?", a: ["Lav", "Kengur", "Slon"], c: 1 },
    { q: "Najvi≈°a planina na svijetu je?", a: ["Mount Everest", "Alpe", "Mont Blanc"], c: 0 },
    { q: "Koja boja nastaje mije≈°anjem plave i ≈æute?", a: ["Zelena", "Ljubiƒçasta", "Narand≈æasta"], c: 0 }
];

let index = 0, score = 0, time = 15, timer;
let ukupnoSekundi = 0, stopwatch;

document.getElementById("qTotal").innerText = questions.length;

// --- ANTI-CHEAT PROVJERA ---
window.onload = function() {
    if (localStorage.getItem("opceKvizUToqu") === "da") {
        index = parseInt(localStorage.getItem("opceKvizIndex")) || 0;
        score = parseInt(localStorage.getItem("opceKvizScore")) || 0;
        ukupnoSekundi = parseInt(localStorage.getItem("opceKvizVrijeme")) || 0;

        alert("Poku≈°ali ste osvje≈æiti stranicu! Pitanje je oznaƒçeno kao netaƒçno.");
        index++; 
        startQuiz(true);
    }
};

function startQuiz(nastavak = false) {
    localStorage.setItem("opceKvizUToqu", "da");
    
    document.getElementById("startScreen").style.display = "none";
    document.getElementById("quizScreen").style.display = "block";
    
    // ≈†TOPERICA (Mjeri ukupno vrijeme za rang listu)
    if (!stopwatch) {
        stopwatch = setInterval(() => { 
            ukupnoSekundi++; 
            localStorage.setItem("opceKvizVrijeme", ukupnoSekundi); 
        }, 1000);
    }

    loadQuestion();
}

function loadQuestion() {
    if (index >= questions.length) { finishQuiz(); return; }
    
    document.getElementById("qIndex").innerText = index + 1;

    localStorage.setItem("opceKvizIndex", index);
    localStorage.setItem("opceKvizScore", score);

    time = 15;
    document.getElementById("time").textContent = time;
    document.getElementById("question").textContent = questions[index].q;
    
    const btns = document.querySelectorAll(".answers button");
    btns.forEach((btn, i) => {
        btn.textContent = questions[index].a[i];
        btn.className = "";
        btn.disabled = false;
    });

    // Tajmer za pojedinaƒçno pitanje
    clearInterval(timer);
    timer = setInterval(() => {
        time--;
        document.getElementById("time").textContent = time;
        if (time <= 0) { 
            clearInterval(timer);
            checkAnswer(-1); // Isteklo vrijeme
        }
    }, 1000);
}

function checkAnswer(ans) {
    clearInterval(timer);
    const btns = document.querySelectorAll(".answers button");
    btns.forEach(b => b.disabled = true);

    if (ans === questions[index].c) {
        btns[ans].classList.add("correct");
        score++;
    } else if (ans !== -1) {
        btns[ans].classList.add("wrong");
        btns[questions[index].c].classList.add("correct");
    } else {
        btns[questions[index].c].classList.add("correct");
    }

    setTimeout(() => {
        index++;
        loadQuestion();
    }, 1200);
}

function finishQuiz() {
    clearInterval(stopwatch);
    clearInterval(timer);
    
    // ƒåi≈°ƒáenje memorije
    localStorage.removeItem("opceKvizUToqu");
    localStorage.removeItem("opceKvizIndex");
    localStorage.removeItem("opceKvizScore");
    localStorage.removeItem("opceKvizVrijeme");

    // SLANJE U BAZU (SADA UKLJUƒåUJE I VRIJEME)
    const formData = new FormData();
    formData.append('score', score);
    formData.append('max', questions.length);
    formData.append('sekunde', ukupnoSekundi);

    fetch('pokreniKviz.php', {
        method: 'POST',
        body: new URLSearchParams(formData)
    })
    .then(response => response.text())
    .then(data => console.log("Baza ka≈æe:", data));

    // Zavr≈°ni ekran
    document.getElementById("quizBox").innerHTML = `
        <div class="result" style="animation: fadeIn 0.5s;">
            <div style="font-size: 60px; margin-bottom: 10px;">üèÜ</div>
            <h2 style="color: #d97706;">Kviz zavr≈°en!</h2>
            
            <div style="background: #fffaf0; padding: 20px; border-radius: 15px; margin: 20px 0;">
                <p style="margin: 10px 0; font-size: 1.2rem;">Taƒçnih odgovora: <strong style="color: #48bb78;">${score} / ${questions.length}</strong></p>
                <p style="margin: 10px 0; font-size: 1.1rem;">Vrijeme: <strong style="color: #d97706;">${ukupnoSekundi} sekundi</strong></p>
            </div>
            
            <a href="index2.php" class="btn">Nazad na Rang Listu</a>
        </div>`;
}
</script>
</body>
</html>