<!DOCTYPE html>
<html lang="bs">
<head>
    <meta charset="UTF-8">
    <title>IT & Tehnologija | Anti-Cheat Kviz</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); margin: 0; padding: 0; }
        .quiz-container { max-width: 600px; background: #fff; margin: 80px auto; padding: 40px; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); text-align: center; }
        .btn { background: #667eea; color: #fff; border: none; padding: 14px 35px; font-size: 16px; border-radius: 30px; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .timer { font-size: 18px; font-weight: 700; color: #667eea; margin-bottom: 20px; }
        .answers button { width: 100%; padding: 14px; margin: 10px 0; border: none; border-radius: 10px; background: #f1f1f1; font-size: 16px; cursor: pointer; }
        .correct { background: #4CAF50 !important; color: #fff; }
        .wrong { background: #e74c3c !important; color: #fff; }
        .warning-box { background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffeeba; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="quiz-container" id="quizBox">
    <div class="intro" id="startScreen">
        <h2>üíª IT & Tehnologija</h2>
        <div class="warning-box">
            ‚ö†Ô∏è <strong>ANTI-CHEAT AKTIVAN:</strong><br>
            Svaki poku≈°aj osvje≈æavanja stranice (Refresh) ƒáe automatski poni≈°titi trenutno pitanje i oznaƒçiti ga kao <strong>netaƒçno</strong>!
        </div>
        <button class="btn" onclick="startQuiz()">Zapoƒçni kviz</button>
    </div>

    <div id="quizScreen" style="display:none;">
        <div class="timer">‚è± Vrijeme: <span id="time">15</span>s</div>
        <h2 id="question"></h2>
        <div class="answers">
            <button onclick="checkAnswer(0)"></button>
            <button onclick="checkAnswer(1)"></button>
            <button onclick="checkAnswer(2)"></button>
        </div>
    </div>
</div>

<script>
const questions = [
    { q: "≈†ta znaƒçi HTML?", a: ["Hyper Text Markup Language", "High Text Machine Language", "Hyperlink Text Mode"], c: 0 },
    { q: "Koji jezik se koristi za baze podataka?", a: ["SQL", "HTML", "CSS"], c: 0 },
    { q: "≈†ta je RAM?", a: ["Trajna memorija", "Radna memorija", "Grafiƒçka kartica"], c: 1 },
    { q: "≈†ta znaƒçi CPU?", a: ["Central Process Unit", "Central Processing Unit", "Computer Personal Unit"], c: 1 },
    { q: "Koji je najpoznatiji operativni sistem?", a: ["Windows", "Google", "Intel"], c: 0 }
];

let index = 0, score = 0, time = 15, timer;
let ukupnoSekundi = 0, stopwatch;

// --- ANTI-CHEAT LOGIKA ---

// Provjeravamo da li je korisnik "pobjegao" sa kviza pro≈°li put
window.onload = function() {
    if (localStorage.getItem("kvizUToqu") === "da") {
        // Ako je kviz bio u toku, vraƒáamo ga tamo gdje je stao
        index = parseInt(localStorage.getItem("kvizIndex")) || 0;
        score = parseInt(localStorage.getItem("kvizScore")) || 0;
        ukupnoSekundi = parseInt(localStorage.getItem("kvizVrijeme")) || 0;

        // KAZNA: Poveƒáavamo indeks (preskaƒçemo pitanje koje je refreshao)
        alert("Poku≈°ali ste osvje≈æiti stranicu! Trenutno pitanje je poni≈°teno.");
        index++; 
        
        startQuiz(true); // Nastavi kviz
    }
};

function startQuiz(nastavak = false) {
    localStorage.setItem("kvizUToqu", "da");
    
    document.getElementById("startScreen").style.display = "none";
    document.getElementById("quizScreen").style.display = "block";
    
    // Pokretanje ukupnog vremena
    stopwatch = setInterval(() => { 
        ukupnoSekundi++; 
        localStorage.setItem("kvizVrijeme", ukupnoSekundi); // Stalno spremamo vrijeme
    }, 1000);

    loadQuestion();
}

function loadQuestion() {
    if (index >= questions.length) { finishQuiz(); return; }
    
    // Spremi trenutni progres u localStorage
    localStorage.setItem("kvizIndex", index);
    localStorage.setItem("kvizScore", score);

    time = 15;
    document.getElementById("time").textContent = time;
    document.getElementById("question").textContent = questions[index].q;
    const btns = document.querySelectorAll(".answers button");
    btns.forEach((btn, i) => {
        btn.textContent = questions[index].a[i];
        btn.className = "";
        btn.disabled = false;
    });

    clearInterval(timer);
    timer = setInterval(() => {
        time--;
        document.getElementById("time").textContent = time;
        if (time === 0) { 
            index++; 
            loadQuestion(); 
        }
    }, 1000);
}

function checkAnswer(ans) {
    clearInterval(timer);
    const btns = document.querySelectorAll(".answers button");
    btns.forEach(b => b.disabled = true);

    if (ans === questions[index].c) {
        btns[ans].classList.add("correct");
        score++;
    } else {
        btns[ans].classList.add("wrong");
        btns[questions[index].c].classList.add("correct");
    }

    setTimeout(() => {
        index++;
        loadQuestion();
    }, 1200);
}

function finishQuiz() {
    clearInterval(stopwatch);
    clearInterval(timer);
    
    // BRI≈†EMO tragove iz memorije jer je kviz gotov po≈°teno
    localStorage.removeItem("kvizUToqu");
    localStorage.removeItem("kvizIndex");
    localStorage.removeItem("kvizScore");
    localStorage.removeItem("kvizVrijeme");

    // Slanje u bazu
    fetch('pokreniKviz.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `score=${score}&max=${questions.length}&sekunde=${ukupnoSekundi}`
    });

    document.getElementById("quizBox").innerHTML = `
        <div class="result">
            üéâ Kviz zavr≈°en!<br><br>
            Konaƒçan rezultat: ${score} / ${questions.length}<br>
            Ukupno vrijeme: ${ukupnoSekundi} sekundi<br><br>
            <button class="btn" onclick="window.location.href='index2.php'">Nazad na izbor</button>
        </div>`;
}
</script>
</body>
</html>