<?php
require "includes/connection.php";

// Provjera sesije
if (!isset($_SESSION['username'])) {
    header("Location: index.php");
    exit();
}
?>
<!DOCTYPE html>
<html lang="bs">
<head>
    <meta charset="UTF-8">
    <title>Nogomet | Kvizomanija</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #11998e, #38ef7d); margin: 0; padding: 0; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .quiz-container { max-width: 600px; width: 90%; background: #fff; padding: 40px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.25); text-align: center; position: relative; overflow: hidden; }
        
        /* Stilovi za Start Ekran */
        .icon-circle { width: 80px; height: 80px; background: #e8f5e9; color: #2e7d32; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 20px; }
        .rules-list { list-style: none; padding: 0; margin: 25px 0; text-align: left; background: #f1f8e9; padding: 20px; border-radius: 12px; }
        .rules-list li { margin-bottom: 12px; font-size: 15px; display: flex; align-items: center; color: #1b5e20; }
        .rules-list li::before { content: '‚öΩ'; margin-right: 10px; }
        
        .btn { background: #2e7d32; color: #fff; border: none; padding: 15px 40px; font-size: 18px; font-weight: 600; border-radius: 30px; cursor: pointer; margin-top: 10px; transition: 0.3s; width: 100%; box-shadow: 0 4px 15px rgba(46, 125, 50, 0.4); }
        .btn:hover { background: #1b5e20; transform: translateY(-3px); box-shadow: 0 6px 20px rgba(46, 125, 50, 0.6); }
        
        .timer { font-size: 18px; font-weight: 700; color: #2e7d32; margin-bottom: 20px; background: #e8f5e9; display: inline-block; padding: 8px 20px; border-radius: 20px; }
        
        .answers button { width: 100%; padding: 16px; margin: 8px 0; border: 2px solid #e8f5e9; border-radius: 12px; background: #fff; font-size: 16px; cursor: pointer; transition: 0.2s; font-weight: 500; color: #1b5e20; text-align: left; padding-left: 20px; }
        .answers button:hover:not([disabled]) { border-color: #2e7d32; background: #f1f8e9; color: #1b5e20; }
        
        .correct { background: #4caf50 !important; color: #fff !important; border-color: #4caf50 !important; }
        .wrong { background: #f44336 !important; color: #fff !important; border-color: #f44336 !important; }
        
        .warning-box { background: #fff5f5; color: #c53030; padding: 12px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f56565; font-size: 0.85rem; text-align: left; }
        h2 { color: #1a202c; margin-bottom: 10px; font-size: 1.8rem; }
        p.desc { color: #718096; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="quiz-container" id="quizBox">
    <div class="intro" id="startScreen">
        <div class="icon-circle">‚öΩ</div>
        <h2>Nogometni Kviz</h2>
        <p class="desc">Jesi li spreman za sportski izazov na terenu?</p>
        
        <ul class="rules-list">
            <li><strong>15 pitanja</strong> o legendama i klubovima.</li>
            <li><strong>15 sekundi</strong> za svaki ≈°ut (pitanje).</li>
            <li>Brzina donosi bolju poziciju na tabeli!</li>
        </ul>

        <div class="warning-box">
            ‚ö†Ô∏è <strong>Sudijska opomena:</strong><br>
            Refresh stranice se ka≈ænjava gubitkom poena na trenutnom pitanju!
        </div>

        <button class="btn" onclick="startQuiz()">Istrƒçi na teren üöÄ</button>
    </div>

    <div id="quizScreen" style="display:none;">
        <div class="timer">‚è± <span id="time">15</span>s</div>
        <h3 id="question" style="min-height: 60px; display: flex; align-items: center; justify-content: center;"></h3>
        <div class="answers" id="answerBtns">
            <button onclick="checkAnswer(0)"></button>
            <button onclick="checkAnswer(1)"></button>
            <button onclick="checkAnswer(2)"></button>
        </div>
        <div style="margin-top: 20px; color: #a0aec0; font-size: 0.9rem;">
            Pitanje <span id="qIndex">1</span> / <span id="qTotal">15</span>
        </div>
    </div>
</div>

<script>
// --- TVOJA PITANJA ---
const questions = [
    { q: "Prvi golman Muje Hrnjice je?", a: ["Mehiƒá", "Fajkoviƒá", "Sabljakoviƒá"], c: 0 },
    { q: "Koja zemlja je osvojila Svjetsko prvenstvo 2018?", a: ["Francuska", "Hrvatska", "Brazil"], c: 0 },
    { q: "Koliko igraƒça ima u standardnom nogometnom timu?", a: ["10", "11", "12"], c: 1 },
    { q: "Koji klub ima nadimak 'Red Devils'?", a: ["Liverpool", "Manchester United", "Chelsea"], c: 1 },
    { q: "Koji igraƒç ima najvi≈°e osvojenih Zlatnih lopti (Ballon d'Or)?", a: ["Lionel Messi", "Cristiano Ronaldo", "Neymar"], c: 0 },
    { q: "Koji stadion je domaƒái teren za Real Madrid?", a: ["Santiago Bernabeu", "Camp Nou", "Old Trafford"], c: 0 },
    { q: "Koji igraƒç je ≈°irom svijeta poznat kao CR7?", a: ["Ronaldinho", "Cristiano Ronaldo", "Ronaldo Nazario"], c: 1 },
    { q: "Koja reprezentacija nosi nadimak 'Oranje'?", a: ["Nizozemska", "Njemaƒçka", "Belgija"], c: 0 },
    { q: "Koji tim je osvojio Ligu prvaka 2022. godine?", a: ["Real Madrid", "Liverpool", "Chelsea"], c: 0 },
    { q: "Koji je najpoznatiji derbi u Liverpoolu?", a: ["Manchester Derby", "North West Derby", "Merseyside Derby"], c: 2 },
    { q: "Koji igraƒç je dugo godina nosio broj 10 u Barceloni?", a: ["Lionel Messi", "Xavi", "Iniesta"], c: 0 },
    { q: "Koja zemlja je domaƒáin EURO 2024?", a: ["Njemaƒçka", "Francuska", "Italija"], c: 0 },
    { q: "Koji klub iz Torina ima najvi≈°e titula u Italiji?", a: ["Juventus", "Inter", "Milan"], c: 0 },
    { q: "Koji igraƒç ima nadimak 'The Egyptian King'?", a: ["Mohamed Salah", "Sadio Mane", "Eden Hazard"], c: 0 },
    { q: "Koja liga se smatra najjaƒçom na svijetu (Engleska)?", a: ["Serie A", "La Liga", "Premier League"], c: 2 }
];

let index = 0, score = 0, time = 15, timer;
let ukupnoSekundi = 0, stopwatch;

document.getElementById("qTotal").innerText = questions.length;

// --- ANTI-CHEAT ---
window.onload = function() {
    if (localStorage.getItem("sportKvizUToqu") === "da") {
        index = parseInt(localStorage.getItem("sportKvizIndex")) || 0;
        score = parseInt(localStorage.getItem("sportKvizScore")) || 0;
        ukupnoSekundi = parseInt(localStorage.getItem("sportKvizVrijeme")) || 0;
        alert("Poku≈°ali ste osvje≈æiti stranicu! ≈†ut proma≈°en (pitanje je netaƒçno).");
        index++; 
        startQuiz(true);
    }
};

function startQuiz(nastavak = false) {
    localStorage.setItem("sportKvizUToqu", "da");
    document.getElementById("startScreen").style.display = "none";
    document.getElementById("quizScreen").style.display = "block";
    
    if (!stopwatch) {
        stopwatch = setInterval(() => { 
            ukupnoSekundi++; 
            localStorage.setItem("sportKvizVrijeme", ukupnoSekundi); 
        }, 1000);
    }
    loadQuestion();
}

function loadQuestion() {
    if (index >= questions.length) { finishQuiz(); return; }
    document.getElementById("qIndex").innerText = index + 1;

    localStorage.setItem("sportKvizIndex", index);
    localStorage.setItem("sportKvizScore", score);

    time = 15;
    document.getElementById("time").textContent = time;
    document.getElementById("question").textContent = questions[index].q;
    
    const btns = document.querySelectorAll(".answers button");
    btns.forEach((btn, i) => {
        btn.textContent = questions[index].a[i];
        btn.className = "";
        btn.disabled = false;
    });

    clearInterval(timer);
    timer = setInterval(() => {
        time--;
        document.getElementById("time").textContent = time;
        if (time <= 0) { clearInterval(timer); checkAnswer(-1); }
    }, 1000);
}

function checkAnswer(ans) {
    clearInterval(timer);
    const btns = document.querySelectorAll(".answers button");
    btns.forEach(b => b.disabled = true);

    if (ans === questions[index].c) {
        btns[ans].classList.add("correct");
        score++;
    } else if (ans !== -1) {
        btns[ans].classList.add("wrong");
        btns[questions[index].c].classList.add("correct");
    } else {
        btns[questions[index].c].classList.add("correct");
    }

    setTimeout(() => {
        index++;
        loadQuestion();
    }, 1200);
}

function finishQuiz() {
    clearInterval(stopwatch);
    clearInterval(timer);
    
    localStorage.removeItem("sportKvizUToqu");
    localStorage.removeItem("sportKvizIndex");
    localStorage.removeItem("sportKvizScore");
    localStorage.removeItem("sportKvizVrijeme");

    // SLANJE U BAZU
    const formData = new FormData();
    formData.append('score', score);
    formData.append('max', questions.length);
    formData.append('sekunde', ukupnoSekundi);

    fetch('pokreniKviz.php', {
        method: 'POST',
        body: new URLSearchParams(formData)
    })
    .then(response => response.text())
    .then(data => console.log("Rezultat spremljen!"));

    document.getElementById("quizBox").innerHTML = `
        <div class="result">
            <div style="font-size: 60px; margin-bottom: 10px;">üèÜ</div>
            <h2 style="color: #2e7d32;">Kraj utakmice!</h2>
            <div style="background: #f1f8e9; padding: 20px; border-radius: 15px; margin: 20px 0;">
                <p style="font-size: 1.2rem;">Postignuti golovi: <strong style="color: #48bb78;">${score} / ${questions.length}</strong></p>
                <p style="font-size: 1.1rem;">Vrijeme: <strong style="color: #2e7d32;">${ukupnoSekundi}s</strong></p>
            </div>
            <a href="index2.php" class="btn">Nazad na tabelu</a>
        </div>`;
}
</script>
</body>
</html>